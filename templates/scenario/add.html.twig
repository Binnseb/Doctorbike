{% extends 'base.html.twig' %}

{% form_theme formAddScenario 'bootstrap_4_layout.html.twig' %}

{% block body %}

    {% for type, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ type }} text-center">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    <div class="block push">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12 text-center">
                    <div class="jumbotron jumbotron-fluid">
                        <h1>Veuillez ajouter votre scénario</h1>
                        <p>Veuillez indiquer dans ce formulaire le nom de votre scénario ainsi que sa première question.</p>
                        <p>Vous pouvez également associer des mots clés à votre scénario afin d'en simplifier la recherche pour l'utilisateur.</p>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="card bg-dark text-primary">
                        <div class="card-header" style="text-align: center">
                            <h4>Début du questionnaire</h4>
                        </div>
                        <div class="card-body">

                            {{ form_start(formAddScenario)  }}

                            {{ form_errors(formAddScenario) }}

                            {{ form_row(formAddScenario.nom, {'attr': {'placeholder': "Exemple : Ma moto ne démarre pas"}}) }}

                            <div class="row js-keyword-wrapper"
                                 data-prototype="{{ form_widget(formAddScenario.motCle.vars.prototype)|e('html_attr') }}"
                                 data-index="{{ formAddScenario.motCle|length }}"
                            >
                                {% for keywordForm in formAddScenario.motCle %}
                                    <div class="col-xs-4 js-keyword-item">
                                        <a href="#" class="js-remove-keyword pull-right">
                                            <span class="fa fa-close"></span>
                                        </a>
                                        {{ form_row(formAddScenario.motCle) }}
                                    </div>
                                {% endfor %}
                                <a href="#" class="js-keyword-add">
                                    <span class="fa fa-plus-circle"></span>
                                    Ajouter un mot clé
                                </a>
                            </div>

                            {{ form_row(formAddScenario.question, {'attr': {'placeholder': "Exemple : La bouton coupe-circuit est il activé ?"}}) }}

                            {{ form_row(formAddScenario.aide, {'attr': {'placeholder': "Exemple : Vous trouverez ce bouton sur le commodo droit de votre moto. Ce dernier est de couleur rouge"}}) }}

                            {{ form_row(formAddScenario.image) }}

                            {{ form_rest(formAddScenario) }}

                            <button type="submit" class="btn btn-success btn-block">Ajouter le scénario et continuer</button>

                            {{ form_end(formAddScenario) }}

                            <br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% block javascripts %}
        {{ parent() }}
        <script>
            jQuery(document).ready(function() {
                var $wrapper = $('.js-keyword-wrapper');
                $wrapper.on('click', '.js-remove-keyword', function(e) {
                    e.preventDefault();
                    $(this).closest('.js-keyword-item')
                        .fadeOut()
                        .remove();
                });
                $wrapper.on('click', '.js-keyword-add', function(e) {
                    e.preventDefault();
                    // Get the data-prototype explained earlier
                    var prototype = $wrapper.data('prototype');
                    // get the new index
                    var index = $wrapper.data('index');
                    // Replace '__name__' in the prototype's HTML to
                    // instead be a number based on how many items we have
                    var newForm = prototype.replace(/__name__/g, index);
                    // increase the index with one for the next item
                    $wrapper.data('index', index + 1);
                    // Display the form in the page before the "new" link
                    $(this).before(newForm);
                });
            });
        </script>
    {% endblock %}

{% endblock %}